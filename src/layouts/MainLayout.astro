---
import "../styles/global.css";
import CookieConsent from "../components/CookieConsent.astro";

interface Props {
  title?: string;
  description?: string;
  keywords?: string;
  canonicalURL?: string;
}

const {
  title = "Cybersecurity Services Malaysia | Training for Universities & SMEs | CyberBros",
  description = "Leading cybersecurity training provider in Malaysia specializing in universities and SMEs. Expert security awareness programs, ethical hacking courses, secure coding training, and cybersecurity education across Kuala Lumpur, Selangor, and Malaysia.",
  keywords = "cybersecurity services Malaysia, cybersecurity training Malaysia, security training universities Malaysia, SME cybersecurity Malaysia, ethical hacking Malaysia, security awareness training, cybersecurity education Malaysia, IT security training KL, infosec training Malaysia, secure coding Malaysia",
  canonicalURL = new URL(Astro.url.pathname, Astro.site)
} = Astro.props;
---

<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>{title}</title>
    <meta name="description" content={description} />
    <meta name="keywords" content={keywords} />
    <link rel="canonical" href={canonicalURL} />
    
    <!-- Geo Meta Tags for Malaysia -->
    <meta name="geo.region" content="MY" />
    <meta name="geo.placename" content="Kuala Lumpur, Malaysia" />
    <meta name="geo.position" content="3.139003;101.686855" />
    <meta name="ICBM" content="3.139003, 101.686855" />
    
    <!-- Additional SEO Tags -->
    <meta name="robots" content="index, follow, max-image-preview:large, max-snippet:-1, max-video-preview:-1" />
    <meta name="author" content="CyberBros Security" />
    <meta name="language" content="English" />
    <meta name="revisit-after" content="7 days" />
    
    <!-- Favicon - Order matters for browser compatibility -->
    <link rel="icon" href="/favicon.ico" sizes="any" />
    <link rel="icon" href="/favicon.svg" type="image/svg+xml" />
    <link rel="apple-touch-icon" href="/apple-touch-icon.png" />
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png" />
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png" />
    <link rel="manifest" href="/site.webmanifest" />
    
    <!-- Theme and PWA -->
    <meta name="theme-color" content="#4f46e5" />
    <meta name="color-scheme" content="dark" />
    
    <!-- Open Graph / Social Media -->
    <meta property="og:type" content="website" />
    <meta property="og:url" content={canonicalURL} />
    <meta property="og:title" content={title} />
    <meta property="og:description" content={description} />
    <meta property="og:site_name" content="CyberBros Security" />
    <meta property="og:locale" content="en_MY" />
    
    <!-- Twitter Card -->
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:url" content={canonicalURL} />
    <meta name="twitter:title" content={title} />
    <meta name="twitter:description" content={description} />
    
    <!-- Schema.org Organization JSON-LD -->
    <script type="application/ld+json">
      {
        "@context": "https://schema.org",
        "@type": "Organization",
        "name": "CyberBros Security",
        "alternateName": "CyberBros",
        "url": "https://cyberbrosecurity.work",
        "logo": "https://cyberbrosecurity.work/logo.png",
        "description": "Leading cybersecurity services provider in Malaysia specializing in training for universities and SMEs",
        "address": {
          "@type": "PostalAddress",
          "addressLocality": "Kuala Lumpur",
          "addressRegion": "Kuala Lumpur",
          "addressCountry": "MY"
        },
        "areaServed": {
          "@type": "Country",
          "name": "Malaysia"
        },
        "serviceArea": {
          "@type": "State",
          "name": "Malaysia"
        },
        "knowsAbout": [
          "Cybersecurity",
          "Security Training",
          "Ethical Hacking",
          "Security Awareness",
          "Mobile Security",
          "Secure Coding",
          "Security Education"
        ],
        "hasOfferCatalog": {
          "@type": "OfferCatalog",
          "name": "Cybersecurity Services",
          "itemListElement": [
            {
              "@type": "Offer",
              "itemOffered": {
                "@type": "Service",
                "name": "Cybersecurity Training for Universities",
                "description": "Comprehensive cybersecurity training programs for Malaysian universities and educational institutions"
              }
            },
            {
              "@type": "Offer",
              "itemOffered": {
                "@type": "Service",
                "name": "SME Cybersecurity Services",
                "description": "Security assessment and training services for small and medium enterprises in Malaysia"
              }
            },
            {
              "@type": "Offer",
              "itemOffered": {
                "@type": "Service",
                "name": "Security Awareness Training",
                "description": "Professional security awareness and training programs for organizations"
              }
            }
          ]
        }
      }
    </script>
  </head>
  <body class="bg-black text-gray-100 font-sans leading-relaxed">
    <slot />
    
    <!-- Cookie Consent Banner -->
    <CookieConsent />

    <!-- Global Scripts -->
    <script>
      // Smooth scroll
      document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener('click', function (e) {
          const href = this.getAttribute('href');
          if (href !== '#') {
            e.preventDefault();
            const target = document.querySelector(href);
            if (target) {
              target.scrollIntoView({ behavior: 'smooth', block: 'start' });
            }
          }
        });
      });

      // Intersection Observer for fade-in animations
      const observerOptions = {
        threshold: 0.1,
        rootMargin: '0px 0px -100px 0px'
      };

      const observer = new IntersectionObserver((entries) => {
        entries.forEach(entry => {
          if (entry.isIntersecting) {
            entry.target.style.opacity = '1';
            entry.target.style.transform = 'translateY(0)';
          }
        });
      }, observerOptions);

      // Apply animations to sections
      document.querySelectorAll('section').forEach((section, index) => {
        if (index > 0) { // Skip first section (hero)
          section.style.opacity = '0';
          section.style.transform = 'translateY(20px)';
          section.style.transition = 'opacity 0.6s ease-out, transform 0.6s ease-out';
          observer.observe(section);
        }
      });

      // Animate stats counter
      const animateCounter = (element, target) => {
        let current = 0;
        const increment = target / 50;
        const timer = setInterval(() => {
          current += increment;
          if (current >= target) {
            element.textContent = target + (element.dataset.suffix || '');
            clearInterval(timer);
          } else {
            element.textContent = Math.floor(current) + (element.dataset.suffix || '');
          }
        }, 30);
      };

      const statsObserver = new IntersectionObserver((entries) => {
        entries.forEach(entry => {
          if (entry.isIntersecting && !entry.target.classList.contains('animated')) {
            const value = entry.target.textContent.replace(/[^0-9]/g, '');
            if (value) { // Only animate if there's a numeric value
              entry.target.dataset.suffix = entry.target.textContent.replace(/[0-9]/g, '');
              animateCounter(entry.target, parseInt(value));
              entry.target.classList.add('animated');
            }
          }
        });
      }, { threshold: 0.5 });

      // Only target statistics numbers, not all bold text
      document.querySelectorAll('section .text-4xl.font-bold.text-indigo-400').forEach(stat => {
        statsObserver.observe(stat);
      });
    </script>

    <style is:global>
      /* Smooth scrolling */
      html {
        scroll-behavior: smooth;
      }

      /* Custom scrollbar */
      ::-webkit-scrollbar {
        width: 10px;
      }

      ::-webkit-scrollbar-track {
        background: #000;
      }

      ::-webkit-scrollbar-thumb {
        background: #4f46e5;
        border-radius: 5px;
      }

      ::-webkit-scrollbar-thumb:hover {
        background: #6366f1;
      }

      /* Details/Summary styling */
      details summary::-webkit-details-marker {
        display: none;
      }

      details[open] summary {
        border-bottom: 1px solid rgb(31, 41, 55);
      }

      /* Hover effects for cards */
      .group:hover {
        transform: translateY(-2px);
      }

      /* Background grid pattern */
      body::before {
        content: '';
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-image: 
          linear-gradient(rgba(79, 70, 229, 0.03) 1px, transparent 1px),
          linear-gradient(90deg, rgba(79, 70, 229, 0.03) 1px, transparent 1px);
        background-size: 50px 50px;
        pointer-events: none;
        z-index: -1;
      }
    </style>
  </body>
</html>
