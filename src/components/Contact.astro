---
---

<section id="contact" class="py-20 px-6 text-center bg-black border-t border-gray-800">
  <div class="max-w-3xl mx-auto">
    <h2 class="text-3xl font-bold text-white mb-4">Let's Build a Safer Digital Future Together</h2>
    <p class="text-gray-400 mb-8">
      Interested in bringing cybersecurity awareness to your university or classroom? Let's connect and create a meaningful learning experience.
    </p>

    <form id="contactForm" class="grid gap-4 max-w-md mx-auto text-left">
      <input 
        type="text" 
        name="name"
        placeholder="Name" 
        required
        class="bg-gray-900 border border-gray-700 text-gray-200 rounded-md px-4 py-2 focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 outline-none placeholder-gray-500" 
      />
      <input 
        type="email" 
        name="email"
        placeholder="Email" 
        required
        class="bg-gray-900 border border-gray-700 text-gray-200 rounded-md px-4 py-2 focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 outline-none placeholder-gray-500" 
      />
      <input 
        type="text" 
        name="institution"
        placeholder="Institution / Organization" 
        class="bg-gray-900 border border-gray-700 text-gray-200 rounded-md px-4 py-2 focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 outline-none placeholder-gray-500" 
      />
      <textarea 
        name="message"
        placeholder="Message" 
        required
        class="bg-gray-900 border border-gray-700 text-gray-200 rounded-md px-4 py-2 h-24 focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 outline-none placeholder-gray-500"
      ></textarea>
      
      <!-- PDPA Compliance Notice and Consent -->
      <div class="bg-gray-900/50 border border-gray-700 rounded-md p-4 text-sm">
        <p class="text-gray-400 mb-3 leading-relaxed">
          <strong class="text-white">Data Protection Notice:</strong> By submitting this form, your personal data (name, email, institution, and message) will be collected and processed by CyberBros Security to respond to your inquiry. Your data will be stored securely and used only for this purpose. You have the right to access, correct, or request deletion of your data at any time.
        </p>
        <label class="flex items-start gap-3 cursor-pointer group">
          <input 
            type="checkbox" 
            name="consent"
            id="consentCheckbox"
            required
            class="mt-1 w-4 h-4 text-indigo-600 bg-gray-800 border-gray-600 rounded focus:ring-indigo-500 focus:ring-2 cursor-pointer"
          />
          <span class="text-gray-300 group-hover:text-gray-200 transition">
            I consent to the collection and processing of my personal data as described above and have read the <a href="/privacy-policy" target="_blank" class="text-indigo-400 hover:text-indigo-300 underline">Privacy Policy</a> and <a href="/terms-of-service" target="_blank" class="text-indigo-400 hover:text-indigo-300 underline">Terms of Service</a>. <span class="text-red-400">*</span>
          </span>
        </label>
      </div>
      
      <div id="formMessage" class="hidden p-3 rounded-md text-sm"></div>
      
      <button 
        type="submit" 
        id="submitBtn"
        class="bg-indigo-600 text-white px-6 py-3 rounded-md hover:bg-indigo-500 transition font-semibold disabled:opacity-50 disabled:cursor-not-allowed"
      >
        Send Message
      </button>
    </form>
  </div>
</section>

<script>
  const form = document.getElementById('contactForm') as HTMLFormElement;
  const submitBtn = document.getElementById('submitBtn') as HTMLButtonElement;
  const formMessage = document.getElementById('formMessage') as HTMLDivElement;

  if (form && submitBtn && formMessage) {
    form.addEventListener('submit', async (e) => {
      e.preventDefault();
      
      // Disable submit button
      submitBtn.disabled = true;
      submitBtn.textContent = 'Sending...';
      
      // Hide previous messages
      formMessage.classList.add('hidden');
      
      // Get form data
      const formData = new FormData(form);
      const consent = formData.get('consent');
      
      // Validate consent checkbox
      if (!consent) {
        formMessage.textContent = 'Please provide consent to process your personal data.';
        formMessage.className = 'p-3 rounded-md text-sm bg-red-900 text-red-200 border border-red-700';
        formMessage.classList.remove('hidden');
        submitBtn.disabled = false;
        submitBtn.textContent = 'Send Message';
        return;
      }
      
      const data = {
        name: formData.get('name') as string,
        email: formData.get('email') as string,
        institution: formData.get('institution') as string,
        message: formData.get('message') as string,
        consent: true,
      };
      
      console.log('Submitting form data:', { ...data, email: '***' }); // Debug log
      
      try {
        const response = await fetch('/api/contact', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify(data),
        });
        
        console.log('Response status:', response.status); // Debug log
        
        let result;
        try {
          result = await response.json();
        } catch (parseError) {
          console.error('Failed to parse response:', parseError);
          throw new Error('Invalid server response');
        }
        
        if (response.ok) {
          // Success
          formMessage.textContent = result.message || 'Message sent successfully! We\'ll get back to you soon.';
          formMessage.className = 'p-3 rounded-md text-sm bg-green-900 text-green-200 border border-green-700';
          form.reset();
        } else {
          // Error
          console.error('Server error:', result);
          formMessage.textContent = result.error || 'Failed to send message. Please try again.';
          formMessage.className = 'p-3 rounded-md text-sm bg-red-900 text-red-200 border border-red-700';
        }
      } catch (error) {
        console.error('Network error:', error);
        formMessage.textContent = 'Network error. Please check your connection and try again.';
        formMessage.className = 'p-3 rounded-md text-sm bg-red-900 text-red-200 border border-red-700';
      } finally {
        // Re-enable submit button
        submitBtn.disabled = false;
        submitBtn.textContent = 'Send Message';
        formMessage.classList.remove('hidden');
      }
    });
  } else {
    console.error('Contact form elements not found');
  }
</script>
