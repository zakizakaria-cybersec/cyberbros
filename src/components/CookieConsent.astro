---
// Cookie Consent Banner Component
// Compliant with Malaysian PDPA requirements
---

<div id="cookieConsent" class="fixed bottom-4 left-4 right-4 md:left-auto md:right-4 md:max-w-md z-50 hidden">
  <div class="bg-gradient-to-br from-gray-900 to-gray-950 border border-gray-700 rounded-xl shadow-2xl backdrop-blur-sm">
    <div class="px-5 py-4">
      <div class="flex flex-col gap-3">
        <!-- Cookie Icon and Text -->
        <div class="flex items-start gap-3">
          <div class="flex-shrink-0 text-2xl">üç™</div>
          <div class="flex-1">
            <p class="text-gray-300 text-sm leading-relaxed">
              We use cookies to improve your experience. Essential cookies keep things running smoothly. 
              <a href="/privacy-policy" class="text-indigo-400 hover:text-indigo-300 underline">Learn more</a>
            </p>
          </div>
        </div>
        
        <!-- Action Buttons -->
        <div class="flex flex-wrap gap-2">
          <button 
            id="cookieAccept" 
            class="flex-1 px-4 py-2 bg-indigo-600 hover:bg-indigo-500 text-white text-sm font-medium rounded-lg transition"
          >
            Accept
          </button>
          <button 
            id="cookieSettings" 
            class="px-4 py-2 bg-gray-800 hover:bg-gray-700 text-white text-sm font-medium rounded-lg transition border border-gray-600"
          >
            Settings
          </button>
          <button 
            id="cookieReject" 
            class="px-4 py-2 text-gray-400 hover:text-gray-300 text-sm font-medium transition"
          >
            Decline
          </button>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Cookie Settings Modal -->
<div id="cookieSettingsModal" class="fixed inset-0 z-50 hidden">
  <!-- Backdrop -->
  <div class="absolute inset-0 bg-black/80 backdrop-blur-sm"></div>
  
  <!-- Modal -->
  <div class="relative min-h-screen flex items-center justify-center p-4">
    <div class="bg-gradient-to-br from-gray-900 to-gray-950 border border-gray-800 rounded-2xl max-w-2xl w-full max-h-[90vh] overflow-y-auto shadow-2xl">
      <!-- Header -->
      <div class="sticky top-0 bg-gradient-to-r from-gray-900 to-gray-950 border-b border-gray-800 px-6 py-4">
        <div class="flex items-center justify-between">
          <h2 class="text-2xl font-bold text-white">Cookie Preferences</h2>
          <button id="closeModal" class="text-gray-400 hover:text-white transition text-2xl">√ó</button>
        </div>
      </div>
      
      <!-- Content -->
      <div class="px-6 py-6 space-y-6">
        <p class="text-gray-300 text-sm leading-relaxed">
          We use cookies to improve your experience on our website. You can choose which types of cookies to allow. 
          Note that blocking some types of cookies may impact your experience on our site.
        </p>
        
        <!-- Essential Cookies -->
        <div class="bg-gray-900/50 border border-gray-800 rounded-lg p-5">
          <div class="flex items-start justify-between mb-3">
            <div class="flex items-center gap-3">
              <span class="text-2xl">üîí</span>
              <div>
                <h3 class="text-white font-semibold">Essential Cookies</h3>
                <span class="text-xs text-gray-400 bg-gray-800 px-2 py-1 rounded">Always Active</span>
              </div>
            </div>
            <div class="flex items-center">
              <input 
                type="checkbox" 
                checked 
                disabled 
                class="w-5 h-5 text-indigo-600 bg-gray-700 border-gray-600 rounded cursor-not-allowed"
              />
            </div>
          </div>
          <p class="text-gray-400 text-sm leading-relaxed ml-11">
            These cookies are necessary for the website to function and cannot be disabled. They are usually set in response to actions you take, such as security settings, login, and form submissions.
          </p>
        </div>
        
        <!-- Analytics Cookies -->
        <div class="bg-gray-900/50 border border-gray-800 rounded-lg p-5">
          <div class="flex items-start justify-between mb-3">
            <div class="flex items-center gap-3">
              <span class="text-2xl">üìä</span>
              <div>
                <h3 class="text-white font-semibold">Analytics Cookies</h3>
                <span class="text-xs text-gray-500">Optional</span>
              </div>
            </div>
            <label class="relative inline-flex items-center cursor-pointer">
              <input 
                type="checkbox" 
                id="analyticsToggle" 
                class="sr-only peer"
              />
              <div class="w-11 h-6 bg-gray-700 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-indigo-800 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-indigo-600"></div>
            </label>
          </div>
          <p class="text-gray-400 text-sm leading-relaxed ml-11">
            These cookies help us understand how visitors interact with our website by collecting and reporting information anonymously. This helps us improve the website's usability and content.
          </p>
        </div>
        
        <!-- Preference Cookies -->
        <div class="bg-gray-900/50 border border-gray-800 rounded-lg p-5">
          <div class="flex items-start justify-between mb-3">
            <div class="flex items-center gap-3">
              <span class="text-2xl">‚öôÔ∏è</span>
              <div>
                <h3 class="text-white font-semibold">Preference Cookies</h3>
                <span class="text-xs text-gray-500">Optional</span>
              </div>
            </div>
            <label class="relative inline-flex items-center cursor-pointer">
              <input 
                type="checkbox" 
                id="preferenceToggle" 
                class="sr-only peer"
              />
              <div class="w-11 h-6 bg-gray-700 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-indigo-800 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-indigo-600"></div>
            </label>
          </div>
          <p class="text-gray-400 text-sm leading-relaxed ml-11">
            These cookies enable the website to remember choices you make (such as language or region) and provide enhanced, personalized features for future visits.
          </p>
        </div>
        
        <!-- Info Box -->
        <div class="bg-indigo-900/20 border border-indigo-700/30 rounded-lg p-4">
          <p class="text-indigo-300 text-sm">
            <strong>üí° Note:</strong> You can change your cookie preferences at any time by clicking the cookie icon at the bottom of any page.
          </p>
        </div>
      </div>
      
      <!-- Footer -->
      <div class="sticky bottom-0 bg-gradient-to-r from-gray-900 to-gray-950 border-t border-gray-800 px-6 py-4 flex flex-col sm:flex-row gap-3 justify-end">
        <button 
          id="savePreferences" 
          class="px-6 py-2.5 bg-gradient-to-r from-indigo-600 to-purple-600 hover:from-indigo-700 hover:to-purple-700 text-white font-semibold rounded-lg transition shadow-lg"
        >
          Save Preferences
        </button>
      </div>
    </div>
  </div>
</div>

<!-- Cookie Settings Button (Fixed, appears after consent is given) -->
<button 
  id="cookieSettingsButton" 
  class="fixed bottom-4 left-4 z-40 bg-gray-900 hover:bg-gray-800 text-white p-3 rounded-full shadow-lg border border-gray-700 transition hidden"
  title="Cookie Settings"
>
  üç™
</button>

<script>
  // Cookie Consent Management
  const COOKIE_CONSENT_KEY = 'cyberbros_cookie_consent';
  const COOKIE_EXPIRY_DAYS = 365;

  // Elements
  const cookieConsent = document.getElementById('cookieConsent');
  const cookieAccept = document.getElementById('cookieAccept');
  const cookieReject = document.getElementById('cookieReject');
  const cookieSettings = document.getElementById('cookieSettings');
  const cookieSettingsModal = document.getElementById('cookieSettingsModal');
  const closeModal = document.getElementById('closeModal');
  const savePreferences = document.getElementById('savePreferences');
  const cookieSettingsButton = document.getElementById('cookieSettingsButton');
  const analyticsToggle = document.getElementById('analyticsToggle') as HTMLInputElement;
  const preferenceToggle = document.getElementById('preferenceToggle') as HTMLInputElement;

  // Check if consent already given
  function checkCookieConsent() {
    const consent = localStorage.getItem(COOKIE_CONSENT_KEY);
    if (!consent) {
      // Show cookie banner
      setTimeout(() => {
        cookieConsent?.classList.remove('hidden');
      }, 1000); // Show after 1 second
    } else {
      // Show settings button if consent was given
      cookieSettingsButton?.classList.remove('hidden');
      
      // Load preferences
      const preferences = JSON.parse(consent);
      if (analyticsToggle) analyticsToggle.checked = preferences.analytics || false;
      if (preferenceToggle) preferenceToggle.checked = preferences.preference || false;
      
      // Apply analytics consent
      if (preferences.analytics) {
        enableAnalytics();
      }
    }
  }

  // Save consent
  function saveCookieConsent(analytics: boolean, preference: boolean) {
    const consent = {
      essential: true, // Always true
      analytics: analytics,
      preference: preference,
      timestamp: new Date().toISOString()
    };
    
    localStorage.setItem(COOKIE_CONSENT_KEY, JSON.stringify(consent));
    
    // Apply analytics consent
    if (analytics) {
      enableAnalytics();
    }
    
    // Hide banner and show settings button
    cookieConsent?.classList.add('hidden');
    cookieSettingsButton?.classList.remove('hidden');
  }

  // Enable analytics (placeholder for actual analytics implementation)
  function enableAnalytics() {
    // TODO: Initialize analytics services (Google Analytics, etc.)
    console.log('Analytics enabled');
    // Example: gtag('consent', 'update', { analytics_storage: 'granted' });
  }

  // Accept all cookies
  cookieAccept?.addEventListener('click', () => {
    saveCookieConsent(true, true);
  });

  // Reject optional cookies
  cookieReject?.addEventListener('click', () => {
    saveCookieConsent(false, false);
  });

  // Open settings modal
  cookieSettings?.addEventListener('click', () => {
    cookieSettingsModal?.classList.remove('hidden');
  });

  // Open settings from fixed button
  cookieSettingsButton?.addEventListener('click', () => {
    // Load current preferences
    const consent = localStorage.getItem(COOKIE_CONSENT_KEY);
    if (consent) {
      const preferences = JSON.parse(consent);
      if (analyticsToggle) analyticsToggle.checked = preferences.analytics || false;
      if (preferenceToggle) preferenceToggle.checked = preferences.preference || false;
    }
    cookieSettingsModal?.classList.remove('hidden');
  });

  // Close modal
  closeModal?.addEventListener('click', () => {
    cookieSettingsModal?.classList.add('hidden');
  });

  // Close modal on backdrop click
  cookieSettingsModal?.addEventListener('click', (e) => {
    if (e.target === cookieSettingsModal) {
      cookieSettingsModal.classList.add('hidden');
    }
  });

  // Save preferences from modal
  savePreferences?.addEventListener('click', () => {
    const analytics = analyticsToggle?.checked || false;
    const preference = preferenceToggle?.checked || false;
    saveCookieConsent(analytics, preference);
    cookieSettingsModal?.classList.add('hidden');
  });

  // Check consent on page load
  checkCookieConsent();
</script>

<style>
  /* Smooth transitions */
  #cookieConsent {
    animation: slideUp 0.3s ease-out;
  }

  @keyframes slideUp {
    from {
      transform: translateY(100%);
      opacity: 0;
    }
    to {
      transform: translateY(0);
      opacity: 1;
    }
  }

  /* Custom scrollbar for modal */
  #cookieSettingsModal > div > div {
    scrollbar-width: thin;
    scrollbar-color: #4B5563 #1F2937;
  }

  #cookieSettingsModal > div > div::-webkit-scrollbar {
    width: 8px;
  }

  #cookieSettingsModal > div > div::-webkit-scrollbar-track {
    background: #1F2937;
    border-radius: 4px;
  }

  #cookieSettingsModal > div > div::-webkit-scrollbar-thumb {
    background: #4B5563;
    border-radius: 4px;
  }

  #cookieSettingsModal > div > div::-webkit-scrollbar-thumb:hover {
    background: #6B7280;
  }
</style>
